<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <link rel="stylesheet" href="styles.css" />
    <title>Register customer</title>
  </head>

  <body>
    <!-- Section 1: ข้อมูลสินค้า -->
    <div class="container">
      <form id="register">
        <div class="header">
          <h4>ข้อมูลสินค้า</h4>
        </div>
        <div class="form-group">
          <label for="crmSerial">Serial No <span class="required-asterisk">*</span></label>
          <input
            type="text"
            id="crmSerial"
            name="crmSerial"
            placeholder="กรุณาระบุ Serial No ตัวอย่าง : UPSF2215433"
            required
          />
        </div>
        <div class="form-group">
          <label for="crmModelId">รุ่นผลิตภัณฑ์ <span class="required-asterisk">*</span></label>
          <div class="select-form">
            <select id="crmModelId" name="crmModelId" required>
              <option disabled selected>กรุณาเลือกรุ่น</option>
            </select>
            <span class="material-symbols-outlined"> keyboard_arrow_down </span>
          </div>
        </div>
        <div class="form-group">
          <label for="crmChannelId"
            >ช่องทางการซื้อผลิตภัณฑ์ <span class="required-asterisk">*</span></label
          >
          <div class="select-form">
            <select id="crmChannelId" name="crmChannelId" required>
              <option disabled selected>กรุณาเลือก</option>
            </select>
            <span class="material-symbols-outlined"> keyboard_arrow_down </span>
          </div>
        </div>
        <div class="form-group">
          <label for="crmChannel">อื่นๆ</label>
          <input type="text" id="crmChannel" name="crmChannel" />
        </div>
        <div class="form-group">
          <label for="crmPurchaseDateStr"
            >วันที่ซื้อผลิตภัณฑ์ <span class="required-asterisk">*</span></label
          >
          <div class="date-picker">
            <input
              type="datetime-local"
              class="date-input"
              id="crmPurchaseDateStr"
              name="crmPurchaseDateStr"
              required
            />
            <label for="dateInput" class="calendar-icon">
              <img src="../src/svg/calendar-days-svgrepo-com.svg" alt="calendar" />
            </label>
          </div>
        </div>

        <div class="form-group">
          <label for="crmFileContent"
            >ใบกำกับภาษีหรือใบเสร็จ <span class="required-asterisk">*</span></label
          >
          <div class="file-upload-container">
            <input type="file" id="crmFileContent" name="crmFileContent" required />
            <label for="fileUpload" class="file-upload-icon">
              <img src="../src/svg/export-svgrepo-com.svg" alt="Upload" />
            </label>
          </div>
        </div>

        <!-- Section 2: รายละเอียดลูกค้า -->
        <div class="header">
          <h4>รายละเอียดลูกค้า</h4>
        </div>

        <div class="form-group">
          <div class="form-one-row">
            <input
              type="radio"
              id="individual"
              name="crmPerson"
              value="1"
              checked
              onchange="toggleOrganizationField()"
            />
            <label for="individual">บุคคลธรรมดา</label>
            <input
              type="radio"
              id="legalEntity"
              name="crmPerson"
              value="2"
              onchange="toggleOrganizationField()"
            />
            <label for="legalEntity">นิติบุคคล</label>
          </div>
        </div>

        <div class="form-group" id="organizationField" style="display: none">
          <label for="crmOrganization"
            >ชื่อนิติบุลคล <span class="required-asterisk">*</span></label
          >
          <input type="text" id="crmOrganization" name="crmOrganization" />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="crmTitleId">คํานําหน้า <span class="required-asterisk">*</span></label>
            <div class="select-form">
              <select id="crmTitleId" name="crmTitleId" required>
                <option disabled selected>กรุณาเลือก</option>
              </select>
              <span class="material-symbols-outlined"> keyboard_arrow_down </span>
            </div>
          </div>
          <div class="form-group">
            <label for="crmNameTh">ชื่อ <span class="required-asterisk">*</span></label>
            <input
              type="text"
              id="crmNameTh"
              name="crmNameTh"
              placeholder="กรุณากรอกชื่อของคุณ"
              required
            />
          </div>

          <div class="form-group">
            <label for="crmSurnameTh">นามสกุล <span class="required-asterisk">*</span></label>
            <input
              type="text"
              id="crmSurnameTh"
              name="crmSurnameTh"
              placeholder="กรุณากรอกนามสกลุลของคุณ"
              required
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="crmTel">เบอร์โทรศัพท์ <span class="required-asterisk">*</span></label>
            <input
              type="text"
              id="crmTel"
              name="crmTel"
              placeholder="ตัวอย่าง: 0891325643"
              required
            />
          </div>
          <div class="form-group">
            <label for="crmEmail">อีเมล</label>
            <input
              type="text"
              id="crmEmail"
              name="crmEmail"
              placeholder="ตัวอย่าง: syndome@gmail.com"
            />
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="crmAddressNo">บ้านเลขที่<span class="required-asterisk">*</span></label>
            <input
              type="text"
              id="crmAddressNo"
              name="crmAddressNo"
              placeholder="กรุณากรอกบ้านเลขที่"
              required
            />
          </div>
          <div class="form-group">
            <label for="crmVillage">หมู่บ้าน/อาคาร/คอนโด</label>
            <input
              type="text"
              id="crmVillage"
              name="villcrmVillageage"
              placeholder="กรุณากรอก หมู่บ้าน/อาคาร/คอนโด"
            />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="crmSoi">ซอย</label>
            <input type="text" id="crmSoi" name="crmSoi" placeholder="กรุณากรอก ซอย" />
          </div>

          <div class="form-group">
            <label for="crmRoad">ถนน</label>
            <input type="text" id="crmRoad" name="crmRoad" placeholder="กรุณากรอก ซอย" />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="crmProvinceCode">จังหวัด <span class="required-asterisk">*</span></label>
            <div class="select-form">
              <select id="crmProvinceCode" name="crmProvinceCode" onchange="getDistrict()" required>
                <option disabled selected>กรุณาเลือก</option>
              </select>
              <span class="material-symbols-outlined"> keyboard_arrow_down </span>
            </div>
          </div>
          <div class="form-group">
            <label for="crmDistrictCode">เขต/อำเภอ <span class="required-asterisk">*</span></label>
            <div class="select-form">
              <select
                id="crmDistrictCode"
                name="crmDistrictCode"
                onchange="getSubDistrict()"
                required
              >
                <option disabled selected>กรุณาเลือก</option>
              </select>
              <span class="material-symbols-outlined"> keyboard_arrow_down </span>
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="crmSubdistrictCode"
              >แขวง/ตำบล <span class="required-asterisk">*</span></label
            >
            <div class="select-form">
              <select
                id="crmSubdistrictCode"
                name="crmSubdistrictCode"
                onchange="getZipCode()"
                required
              >
                <option disabled selected>กรุณาเลือก</option>
              </select>
              <span class="material-symbols-outlined"> keyboard_arrow_down </span>
            </div>
          </div>
          <div class="form-group">
            <label for="crmPostalCode">รหัสไปรษณีย์ <span class="required-asterisk">*</span></label>
            <input
              type="text"
              id="crmPostalCode"
              name="crmPostalCode"
              placeholder="รหัสไปรษณีย์"
              required
            />
          </div>
        </div>
        <div class="agreement">
          <label class="checkbox-container">
            <input type="checkbox" id="agreementCheckbox" name="agreement" required />
            <span class="checkmark"></span>
            ข้าพเจ้าได้ตรวจและยอมรับเงื่อนไขตามที่ระบุไว้ และยินยอมให้ความยินยอมในการเก็บ
            ใช้และเปิดเผยข้อมูลส่วนบุคคลของข้าพเจ้า ตามวัตถุประสงค์ที่เกี่ยวข้องตามนโยบาย
          </label>
        </div>
        <div class="center">
          <button onclick="submitForm()">ลงทะเบียนรับประกัน</button>
        </div>
      </form>
    </div>

    <script>
      getModel()
      getProvince()
      getPrefix()
      getChannel()

      function getChannel() {
        const xhr = new XMLHttpRequest()
        xhr.open('POST', 'http://192.168.10.250/bpmws/BPMSaleOrderService?wsdl')
        xhr.setRequestHeader('Content-Type', 'text/xml;charset=UTF-8')
        const soapBody =
          '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:bpm="http://bpmws/">' +
          '<soapenv:Header/>' +
          '<soapenv:Body>' +
          '<bpm:BPM_TargetApplication_ChannelList/>' +
          '</soapenv:Body>' +
          '</soapenv:Envelope>'
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const xmlDoc = this.responseXML
            const result = xmlDoc.getElementsByTagName('crmChannelList')
            const selectModel = document.getElementById('crmChannelId')
            for (const element of result) {
              const items = element.childNodes
              const optionElement = document.createElement('option')
              optionElement.textContent = items[2].innerHTML
              optionElement.value = items[1].innerHTML
              selectModel.appendChild(optionElement)
            }
          }
        }
        xhr.send(soapBody)
      }

      function getModel() {
        const xhr = new XMLHttpRequest()
        xhr.open('POST', 'http://192.168.10.250/bpmws/BPMSaleOrderService?wsdl')
        xhr.setRequestHeader('Content-Type', 'text/xml;charset=UTF-8')
        const soapBody =
          '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:bpm="http://bpmws/">' +
          '<soapenv:Header/>' +
          '<soapenv:Body>' +
          '<bpm:BPM_TargetApplication_ModelList/>' +
          '</soapenv:Body>' +
          '</soapenv:Envelope>'
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const xmlDoc = this.responseXML
            const result = xmlDoc.getElementsByTagName('crmModelList')
            const selectModel = document.getElementById('crmModelId')
            for (const element of result) {
              const items = element.childNodes
              const optionElement = document.createElement('option')
              optionElement.textContent = items[2].innerHTML
              optionElement.value = items[1].innerHTML
              selectModel.appendChild(optionElement)
            }
          }
        }
        xhr.send(soapBody)
      }

      function getProvince() {
        const xhr = new XMLHttpRequest()
        xhr.open('POST', 'http://192.168.10.250/bpmws/BPMSaleOrderService?wsdl')
        xhr.setRequestHeader('Content-Type', 'text/xml;charset=UTF-8')
        const soapBody =
          '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:bpm="http://bpmws/">' +
          '<soapenv:Header/>' +
          '<soapenv:Body>' +
          '<bpm:BPM_TargetApplication_ProvinceList/>' +
          '</soapenv:Body>' +
          '</soapenv:Envelope>'
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const xmlDoc = this.responseXML
            const result = xmlDoc.getElementsByTagName('provinceList')
            const selectModel = document.getElementById('crmProvinceCode')
            for (const element of result) {
              const items = element.childNodes
              const optionElement = document.createElement('option')
              optionElement.textContent = items[3].innerHTML
              optionElement.value = items[0].innerHTML
              selectModel.appendChild(optionElement)
            }
          }
        }
        xhr.send(soapBody)
      }

      function getPrefix() {
        const xhr = new XMLHttpRequest()
        xhr.open('POST', 'http://192.168.10.250/bpmws/BPMSaleOrderService?wsdl')
        xhr.setRequestHeader('Content-Type', 'text/xml;charset=UTF-8')
        const soapBody =
          '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:bpm="http://bpmws/">' +
          '<soapenv:Header/>' +
          '<soapenv:Body>' +
          '<bpm:BPM_TargetApplication_TitleList/>' +
          '</soapenv:Body>' +
          '</soapenv:Envelope>'
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const xmlDoc = this.responseXML
            const result = xmlDoc.getElementsByTagName('titleList')
            const selectModel = document.getElementById('crmTitleId')
            for (let i = 0; i < result.length; i++) {
              const items = result[i].childNodes
              const optionElement = document.createElement('option')
              optionElement.textContent = items[3].innerHTML
              optionElement.value = items[1].innerHTML
              selectModel.appendChild(optionElement)
            }
          }
        }
        xhr.send(soapBody)
      }

      function getDistrict() {
        const districtSelect = document.getElementById('crmDistrictCode')
        districtSelect.innerHTML = '<option disabled selected>กรุณาเลือก</option>'
        const xhr = new XMLHttpRequest()
        xhr.open('POST', 'http://192.168.10.250/bpmws/BPMSaleOrderService?wsdl')
        xhr.setRequestHeader('Content-Type', 'text/xml;charset=UTF-8')
        const selectedProvince = document.getElementById('crmProvinceCode').value
        const soapBody =
          '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:bpm="http://bpmws/">' +
          '<soapenv:Header/>' +
          '<soapenv:Body>' +
          '<bpm:BPM_TargetApplication_SearchGeo>' +
          '<!--Optional:-->' +
          '<geo>province</geo>' +
          '<!--Optional:-->' +
          '<target>district</target>' +
          '<!--Optional:-->' +
          '<code>' +
          selectedProvince +
          '</code>' +
          '</bpm:BPM_TargetApplication_SearchGeo>' +
          '</soapenv:Body>' +
          '</soapenv:Envelope>'
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const xmlDoc = this.responseXML
            const result = xmlDoc.getElementsByTagName('commonList')
            const select = document.getElementById('crmDistrictCode')
            for (let i = 0; i < result.length; i++) {
              const items = result[i].childNodes
              const optionElement = document.createElement('option')
              optionElement.textContent = items[1].innerHTML
              optionElement.value = items[0].innerHTML
              select.appendChild(optionElement)
            }
          }
        }
        xhr.send(soapBody)
      }

      function getSubDistrict() {
        const selectedValue = document.getElementById('crmDistrictCode').value
        const districtSelect = document.getElementById('crmSubdistrictCode')
        districtSelect.innerHTML = '<option disabled selected>กรุณาเลือก</option>'
        if (!selectedValue) return
        const xhr = new XMLHttpRequest()
        xhr.open('POST', 'http://192.168.10.250/bpmws/BPMSaleOrderService?wsdl')
        xhr.setRequestHeader('Content-Type', 'text/xml;charset=UTF-8')
        const soapBody =
          '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:bpm="http://bpmws/">' +
          '<soapenv:Header/>' +
          '<soapenv:Body>' +
          '<bpm:BPM_TargetApplication_SearchGeo>' +
          '<!--Optional:-->' +
          '<geo>district</geo>' +
          '<!--Optional:-->' +
          '<target>subdistrict</target>' +
          '<!--Optional:-->' +
          '<code>' +
          selectedValue +
          '</code>' +
          '</bpm:BPM_TargetApplication_SearchGeo>' +
          '</soapenv:Body>' +
          '</soapenv:Envelope>'
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const xmlDoc = this.responseXML
            const result = xmlDoc.getElementsByTagName('commonList')
            const select = document.getElementById('crmSubdistrictCode')
            for (let i = 0; i < result.length; i++) {
              const items = result[i].childNodes
              const optionElement = document.createElement('option')
              optionElement.textContent = items[1].innerHTML
              optionElement.value = items[0].innerHTML
              select.appendChild(optionElement)
            }
          }
        }
        xhr.send(soapBody)
      }

      function getZipCode() {
        const selectedValue = document.getElementById('crmSubdistrictCode').value
        const zipcode = document.getElementById('crmPostalCode')
        zipcode.value = ''
        if (!selectedValue) return
        const xhr = new XMLHttpRequest()
        xhr.open('POST', 'http://192.168.10.250/bpmws/BPMSaleOrderService?wsdl')
        xhr.setRequestHeader('Content-Type', 'text/xml;charset=UTF-8')
        const soapBody =
          '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:bpm="http://bpmws/">' +
          '<soapenv:Header/>' +
          '<soapenv:Body>' +
          '<bpm:BPM_TargetApplication_GetZipcode>' +
          '<!--Optional:-->' +
          '<geo>subdistrict</geo>' +
          '<!--Optional:-->' +
          '<code>' +
          selectedValue +
          '</code>' +
          '</bpm:BPM_TargetApplication_GetZipcode>' +
          '</soapenv:Body>' +
          '</soapenv:Envelope>'
        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const xmlDoc = this.responseXML
            const result = xmlDoc.getElementsByTagName('postCode')
            zipcode.value = result[0].innerHTML
          }
        }
        xhr.send(soapBody)
      }

      function submitForm() {
        const crmSerial = document.getElementById('crmSerial').value
        const crmPurchaseDateStr = document.getElementById('crmPurchaseDateStr').value
        const crmNameTh = document.getElementById('crmNameTh').value
        const crmSurnameTh = document.getElementById('crmSurnameTh').value
        const crmTel = document.getElementById('crmTel').value
        const crmEmail = document.getElementById('crmEmail').value
        const crmAddressNo = document.getElementById('crmAddressNo').value
        const crmVillage = document.getElementById('crmVillage').value
        const crmSoi = document.getElementById('crmSoi').value
        const crmRoad = document.getElementById('crmRoad').value
        const crmPostalCode = document.getElementById('crmPostalCode').value
        const crmModelId = document.getElementById('crmModelId').value
        const crmTitleId = document.getElementById('crmTitleId').value
        const crmProvinceCode = document.getElementById('crmProvinceCode').value
        const crmDistrictCode = document.getElementById('crmDistrictCode').value
        const crmSubdistrictCode = document.getElementById('crmSubdistrictCode').value
        const crmFileContent = document.getElementById('crmFileContent')
        const crmChannelId = document.getElementById('crmChannelId').value
        const crmChannel = document.getElementById('crmFileContent').value
        const crmOrganization = document.getElementById('crmOrganization').value
        let crmPerson = 1
        const radioButtons = document.getElementsByName('crmPerson')
        for (let i = 0; i < radioButtons.length; i++) {
          if (radioButtons[i].checked) {
            crmPerson = radioButtons[i].value
          }
        }
        const xhr = new XMLHttpRequest()
        xhr.open('POST', 'http://192.168.10.250/bpmws/BPMSaleOrderService?wsdl')
        xhr.setRequestHeader('Content-Type', 'text/xml;charset=UTF-8')
        const soapBody =
          '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:bpm="http://bpmws/">' +
          '<soapenv:Header/>' +
          '<soapenv:Body>' +
          '<bpm:BPM_TargetApplication_AddSerialCustomer>' +
          '<!--Optional:-->' +
          '<crmCustomerBean>' +
          '<crmAddressNo>' +
          crmAddressNo +
          '</crmAddressNo>' +
          '<crmChannel>' +
          crmChannel +
          '</crmChannel>' +
          '<crmChannelId>' +
          crmChannelId +
          '</crmChannelId>' +
          '<crmDistrictCode>' +
          crmDistrictCode +
          '</crmDistrictCode>' +
          '<crmEmail>' +
          crmEmail +
          '</crmEmail>' +
          '<crmFileName>' +
          crmFileContent.files[0].name +
          '</crmFileName>' +
          '<crmFilePath>' +
          crmFileContent.value +
          '</crmFilePath>' +
          '<crmFileTmpName>' +
          crmFileContent.value +
          '</crmFileTmpName>' +
          '<crmFileContent>' +
          crmFileContent.files[0].type +
          '</crmFileContent>' +
          '<crmModelId>' +
          crmModelId +
          '</crmModelId>' +
          '<crmNameTh>' +
          crmNameTh +
          '</crmNameTh>' +
          '<crmOrganization>' +
          crmOrganization +
          '</crmOrganization>' +
          '<crmPerson>' +
          crmPerson +
          '</crmPerson>' +
          '<crmPostalCode>' +
          crmPostalCode +
          '</crmPostalCode>' +
          '<crmProvinceCode>' +
          crmProvinceCode +
          '</crmProvinceCode>' +
          '<crmPurchaseDateStr>' +
          crmPurchaseDateStr +
          '</crmPurchaseDateStr>' +
          // '<crmRemark>remark</crmRemark>' +
          '<crmRoad>' +
          crmRoad +
          '</crmRoad>' +
          '<crmSerial>' +
          crmSerial +
          '</crmSerial>' +
          '<crmSoi>' +
          crmSoi +
          '</crmSoi>' +
          '<crmSubdistrictCode>' +
          crmSubdistrictCode +
          '</crmSubdistrictCode>' +
          '<crmSurnameTh>' +
          crmSurnameTh +
          '</crmSurnameTh>' +
          '<crmTel>' +
          crmTel +
          '</crmTel>' +
          '<crmTitleId>' +
          crmTitleId +
          '</crmTitleId>' +
          '<crmVillage>' +
          crmVillage +
          '</crmVillage>' +
          '</crmCustomerBean>' +
          '</bpm:BPM_TargetApplication_AddSerialCustomer>' +
          '</soapenv:Body>' +
          '</soapenv:Envelope>'

        xhr.onreadystatechange = function () {
          if (xhr.readyState === 4 && xhr.status === 200) {
            const xmlDoc = this.responseXML
            const msgStatus = xmlDoc.getElementsByTagName('msgStatus')[0].innerHTML
            if (msgStatus === 'FAIL') {
              alert(msgStatus)
            } else {
              alert(xmlDoc.getElementsByTagName('message')[0].innerHTML)
            }
          }
        }
        xhr.send(soapBody)
      }
      function toggleOrganizationField() {
        var radioValue = document.querySelector('input[name="crmPerson"]:checked').value
        var organizationField = document.getElementById('organizationField')
        if (radioValue === '2') {
          organizationField.style.display = 'block' // Show
        } else {
          organizationField.style.display = 'none' // Hide
        }
      }

      // Call the function on page load to set the correct initial state
      window.onload = toggleOrganizationField
    </script>
  </body>
</html>
